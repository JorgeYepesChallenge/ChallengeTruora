<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>OnboardAI - Local test</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto;max-width:900px;margin:36px;}
    textarea{width:100%;height:200px}
    input, button{padding:8px;margin:6px 0}
    pre{background:#f6f8fa;padding:12px;border-radius:6px}
  </style>
</head>
<body>
  <h2>OnboardAI - Enviar payload a n8n webhook</h2>
  <label>Webhook URL (ej: http://localhost:5678/webhook/onboarding/create)</label><br/>
  <input id="webhook" type="text" style="width:100%" value="http://localhost:5678/webhook/onboarding/create"/>
  <p>Payload JSON:</p>
  <textarea id="payload">{ "client": "demo", "pedido": 123, "items": [{"sku":"S1","qty":2}] }</textarea>
  <p>Expected schema (opcional):</p>
  <textarea id="schema">{ "type": "object", "properties": { "client": {"type":"string"} }, "required": ["client"] }</textarea>
  <p><button id="send">Enviar a webhook</button></p>
  <h3>Respuesta</h3>
  <pre id="response">Sin enviar</pre>

<script>
document.getElementById('send').addEventListener('click', async () => {
  const url = document.getElementById('webhook').value;
  let payload = JSON.parse(document.getElementById('payload').value || '{}');
  const schemaText = document.getElementById('schema').value.trim();
  const body = {
    payload,
    expected_schema: schemaText ? JSON.parse(schemaText) : null,
    test_endpoint: null
  };
  try {
    const r = await fetch(url, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(body),
    });
    const data = await r.json();
    document.getElementById('response').textContent = JSON.stringify(data, null, 2);
  } catch (e) {
    document.getElementById('response').textContent = 'Error: ' + e.message;
  }
});
</script>
</body>
</html>
